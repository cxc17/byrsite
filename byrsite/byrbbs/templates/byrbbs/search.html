{% load staticfiles %}
{% load byrbbs_extras %}

<!DOCTYPE html>
<html lang="zh-CN" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"
      xmlns="http://www.w3.org/1999/html">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{ key }}_论坛搜索</title>
        <link rel="icon" sizes="any" mask="" href="{% static 'byrbbs/images/logo_title.png' %}">
        <link href="http://apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet" />
        <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
	    <script src="http://apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>

		<link rel="stylesheet" href="../../static/byrbbs/rendezvous.css">

        <link rel="stylesheet" href="{% static 'byrbbs/search_style.css' %}">
    </head>

    <script>
        $(document).ready(function(){
            $("#UserModal").on("hidden.bs.modal", function() {
                $(this).removeData("bs.modal");
            });
        });

        $(function() {
            //阻止点击label由于事件传递的原因收起菜单
            $(".dropdown-menu").on("click", "[data-stopPropagation]", function(e) {
                e.stopPropagation();
            });
        });
    </script>

    <body>
        <div style="position: relative; min-height:100%; ">
        <div id="header">
            <div class="header-brand">
                <a href="/byrbbs">
                <img src="{% static 'byrbbs/images/logo.png' %}"  width="100" height="28">
                </a>
                <form id="form" method="GET" action="/byrbbs/">
                    <input class="header-search" type="text" id="bbssearch" name="key" maxlength="40" value="{{ key }}">
                    <button type="submit" id="search-button" class="search-button">搜 索</button>
                </form>
            </div>

            <div id="header-navigation">
                <div class="{{ type|menu_type:"all" }}"><a href="/byrbbs/?key={{ key }}&type=all">全部</a></div>
                <div class="{{ type|menu_type:"user" }}"><a href="/byrbbs/?key={{ key }}&type=user">用户</a></div>
                <div class="{{ type|menu_type:"data" }}"><a href="/byrbbs/?key={{ key }}&type=data">大数据</a></div>

                <div class="btn-group">
                    <div id="menu1" data-toggle="dropdown">时间不限<span class="caret"></span></div>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="/byrbbs/?key={{ key }}&time=all">时间不限</a>
                        </li>
                        <li>
                            <a href="/byrbbs/?key={{ key }}&time=1">一天内</a>
                        </li>
                        <li>
                            <a href="/byrbbs/?key={{ key }}&time=7">一周内</a>
                        </li>
                        <li>
                            <a href="/byrbbs/?key={{ key }}&time=30">一月内</a>
                        </li>
                        <li>
                            <a href="/byrbbs/?key={{ key }}&time=365">一年内</a>
                        </li>
                        <li class="divider">
                        </li>
                        <div data-stopPropagation="true" style="font-size: small; line-height: 22PX; padding-top: 20px; color: #777;padding-left: 20px">
                            <p style="position: absolute; top: 140px;">自定义</p>
{#                            从<input name="st" date-min="0" date-max="20160921" type="datetime" autocomplete="off" value="2016-09-21" data-value="1474387200000" class="c-tip-custom-input">#}
{#                            至<input name="st" date-min="0" date-max="20160921" type="date" autocomplete="off" value="2016-09-21" data-value="1474387200000" class="c-tip-custom-input">#}
                            <div id="rendez-vous-french"></div>
                            <script src="../../static/byrbbs/js/syntaxhighlighter/shCore.js"></script>
                            <script src="../../static/byrbbs/js/rendezvous.js"></script>
                            <script src="../../static/byrbbs/js/app.js"></script>
                            <button style=" margin-top: 5px;margin-bottom: 5px;">确认</button>
                        </div>
                    </ul>
                </div>
            </div>

        </div>

        <div class="container">
            <div class="list-container">
                <div class="list box">
                    <p id="list-info">
                        {% if page > 1%}
                            找到 {{ search_count|search_count }} 条结果，以下是第 {{ page }} 页 ( 用时{{ search_time|search_time }}秒 )
                        {% else %}
                            找到 {{ search_count|search_count }} 条结果 ( 用时{{ search_time|search_time }}秒 )
                        {% endif %}
                    </p>
                </div>
                {% if search_count == 0%}
                    <div class="list box">
                        <p style="padding-top:.33em"> 抱歉，没有找到和您查询的"<b>{{ key }}</b>"相符的内容。</p>
                        <p style="margin-top:1em">建议：
                        <ul>
                            <li>请检查输入字词有无错误。</li>
                            <li>请尝试其他查询词。</li>
                            <li>请改用较常见的字词。</li>
                        </ul>
                    </div>
                {% endif %}

                {% for result in search_result %}
                    <div class="list box">
                        <h4>
                            <a href={{ result.url }} target="_blank">{{ result.title}}</a>
                        </h4>
                        <br/>
                        <div>
                            <span>
                            <a href={{ result.url }} target="_blank">
                                {{ result.url}}
                            </a>&nbsp;&nbsp;
                                {% if result.board_name %}
                                    发帖者：
                                {% else %}
                                    跟帖者：
                                {% endif %}
                            </span>
                            <a href="/byrbbs/user?uid={{ result.user_id }}" data-toggle="modal" data-target="#UserModal">
                                {{ result.user_id|search_key:key|safe }}({{ result.user_name|search_key:key|safe }})
                            </a>
                            <span>
                                &nbsp;&nbsp;{{ result.publish_time|date:"D M d H:i:s Y" }}
                            </span>
                        </div>
                        <br/>
                        <p>{{ result.content|content_output_max}}</p>
                    </div>
                {% endfor %}
            <br/>
                {% if page_max > 1%}
                <div class="list-pagination" id="page">
                    {% if page > 1%}
                        <a href="?key={{ key }}&p={{ page|add:"-1" }}&time={{ time }}" jp-role="last" jp-data="上一页">&lt;上一页</a>
                    {% endif %}

                    {% for page_num in page|page_list_pre %}
                        <a href="?key={{ key }}&p={{ page_num }}&time={{ time }}" jp-role="page" jp-data={{ page_num }}>{{ page_num }}</a>
                    {% endfor %}

                    <a href="?key={{ key }}&p={{ page }}&time={{ time }}" jp-role="page" jp-data="1" class="active">{{ page }}</a>

                    {% for page_num in page|page_list_next:page_max %}
                        <a href="?key={{ key }}&p={{ page_num }}&time={{ time }}" jp-role="page" jp-data={{ page_num }}>{{ page_num }}</a>
                    {% endfor %}

                    {% if page < page_max%}
                        <a href="?key={{ key }}&p={{ page|add:"1" }}&time={{ time }}" jp-role="last" jp-data="下一页">下一页&gt;</a>
                    {% endif %}
                </div>
                {% endif %}

            <br/>
            </div>
        </div>

        <div id="footer-2">
            <h5>Copyright © 2016 BUPT::Cxc_17 &nbsp;|
                <a href="mailto: caixiaochuan@sina.cn">&nbsp;联系我们</a>
            </h5>
        </div>

        {# 用户信息模态框 #}
        <div class="modal fade" id="UserModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
            <div class="modal-dialog">
                <div class="modal-content">


                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>

        </div>
    </body>
</html>